<html><head><base href="." /><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Quotex Trading Analysis Platform</title><style>
:root {
  --primary: #2c3e50;
  --secondary: #34495e;
  --accent: #3498db;
  --success: #27ae60;
  --danger: #e74c3c;
  --light: #ecf0f1;
}

body {
  font-family: 'Roboto', sans-serif;
  margin: 0;
  padding: 0;
  background: var(--primary);
  color: var(--light);
}

.container {
  max-width: 1000px; /* Slightly smaller max-width */
  padding: 15px;
}

.capabilities {
  background: var(--secondary);
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 20px;
  border: 1px solid var(--accent);
}

.capabilities-title {
  color: var(--accent);
  font-size: 1.2em;
  margin-bottom: 10px;
  font-weight: bold;
}

.capabilities-list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 10px;
}

.capability-item {
  background: rgba(255, 255, 255, 0.1);
  padding: 8px;
  border-radius: 5px;
  font-size: 0.9em;
}

.trade-stats {
  background: var(--secondary);
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 20px;
  border: 1px solid var(--accent);
}

.stats-title {
  color: var(--accent);
  font-size: 1.2em;
  margin-bottom: 10px;
  font-weight: bold;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
}

.stat-box {
  background: rgba(255, 255, 255, 0.1);
  padding: 10px;
  border-radius: 5px;
  text-align: center;
}

.stat-label {
  font-size: 0.9em;
}

.stat-value {
  font-size: 1.5em;
  font-weight: bold;
  margin-top: 5px;
}

.success-trades {
  color: var(--success);
}

.failed-trades {
  color: var(--danger);
}

.win-rate {
  color: var(--accent);
}

.dashboard {
  display: block;
  margin-top: 20px;
}

.pairs-grid {
  display: grid;
  grid-template-rows: auto auto;
  gap: 12px;
}

.high-confidence-row {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin-bottom: 15px;
}

.regular-row {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
}

.currency-pair {
  min-height: 140px; /* Reduced height */
  background: var(--secondary);
  border-radius: 10px;
  padding: 12px;
  position: relative;
  opacity: 0.6;
  transition: opacity 0.3s ease;
}

.currency-pair.high-confidence {
  opacity: 1;
  box-shadow: 0 0 15px rgba(52, 152, 219, 0.5);
  border: 2px solid var(--accent);
}

.high-confidence .metric-value {
  color: #f1c40f;
  font-size: 1.2em;
}

.tools-used {
  font-size: 0.7em; /* Adjusted font size */
  color: var(--accent);
  margin-top: 8px; /* Adjusted margin */
  padding-top: 8px; /* Adjusted padding */
  border-top: 1px solid rgba(255,255,255,0.1);
}

.waiting-indicator {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0,0,0,0.8);
  padding: 10px 20px;
  border-radius: 5px;
  display: none;
}

.analyzing .waiting-indicator {
  display: block;
}

.pair-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.pair-name {
  font-size: 1em; /* Adjusted font size */
  font-weight: bold;
}

.loader {
  width: 40px;
  height: 40px;
  border: 4px solid var(--light);
  border-top: 4px solid var(--accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.trend-indicator {
  display: flex;
  align-items: center;
  gap: 8px; /* Adjusted gap */
  margin-top: 8px; /* Adjusted margin */
}

.trend-arrow {
  font-size: 20px;
  font-weight: bold;
}

.trend-up {
  color: var(--success);
}

.trend-down {
  color: var(--danger);
}

.metric {
  background: rgba(255, 255, 255, 0.1);
  padding: 6px; /* Adjusted padding */
  margin: 4px 0; /* Adjusted margin */
  border-radius: 5px;
  text-align: center;
}

.metric-value {
  font-size: 1em;
  font-weight: bold;
  color: var(--accent);
}

.entry-times {
  background: rgba(0,0,0,0.2);
  padding: 8px; /* Refined padding */
  border-radius: 8px;
  margin-top: 8px; /* Adjusted margin */
}

.entry-time {
  border-bottom: 1px solid rgba(255,255,255,0.1);
  padding: 6px 0; /* Adjusted padding */
  margin: 1px 0; /* Adjusted margin */
}

.entry-confidence {
  color: #f1c40f;
  font-size: 0.85em; /* Adjusted font size */
  font-weight: bold;
}

.entry-time:last-child {
  border-bottom: none;
}

.ideal-time {
  color: #f1c40f;
  font-weight: bold;
  font-size: 1em; /* Adjusted font size */
  font-family: 'Courier New', monospace;
  display: block;
  margin: 3px 0; /* Adjusted margin */
  letter-spacing: 1px;
}

.current-time {
  color: #3498db;
  font-size: 1em;
  border-top: 1px solid rgba(255,255,255,0.1);
  padding-top: 10px;
  margin-top: 8px;
}

.time-label {
  color: #95a5a6;
}

.time-seconds {
  color: #95a5a6;
  font-size: 0.9em;
}

.duration {
  color: var(--success);
  font-weight: bold;
  font-size: 0.9em;
}

.trade-confirmation {
  background: rgba(0,0,0,0.2);
  padding: 10px;
  border-radius: 8px;
  margin-top: 10px;
  font-size: 0.85em;
  color: #bdc3c7;
}

.trade-status {
  color: var(--success);
  font-weight: bold;
  margin-top: 5px;
}

.trade-recommendation {
  color: #95a5a6;
  font-size: 0.85em;
  margin-top: 3px;
}

.api-settings {
  background: var(--secondary);
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 20px;
  border: 1px solid var(--accent);
}

.api-content {
  background: rgba(255, 255, 255, 0.1);
  padding: 15px;
  border-radius: 5px;
  margin-top: 10px;
}

.api-key-display {
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.generate-key-btn, .show-key-btn {
  background: var(--accent);
  color: white;
  border: none;
  padding: 8px 15px;
  border-radius: 5px;
  cursor: pointer;
  transition: opacity 0.3s;
}

.generate-key-btn:hover, .show-key-btn:hover {
  opacity: 0.8;
}

.api-status {
  margin-top: 15px;
  padding-top: 15px;
  border-top: 1px solid rgba(255,255,255,0.1);
}

.form-control {
  width: 100%;
  padding: 8px;
  margin: 5px 0;
  border-radius: 5px;
  border: 1px solid var(--accent);
  background: rgba(255,255,255,0.1);
  color: var(--light);
}

.form-group label {
  display: block;
  margin-bottom: 5px;
  color: var(--light);
}

.save-settings-btn:hover {
  opacity: 0.9;
}

#connection-status, #sync-status {
  color: var(--danger);
}

#connection-status.connected, #sync-status.synced {
  color: var(--success);
}

.broker-panels {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 15px;
  margin-top: 15px;
}

.broker-panel {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  padding: 15px;
  border: 1px solid var(--accent);
}

.broker-panel h3 {
  color: var(--accent);
  margin: 0 0 15px 0;
  font-size: 1.1em;
}

.account-status {
  margin-top: 15px;
  padding-top: 15px;
  border-top: 1px solid rgba(255,255,255,0.1);
}

.status {
  padding: 3px 8px;
  border-radius: 3px;
  font-size: 0.9em;
}

.status.connected {
  background: var(--success);
  color: white;
}

.broker-trades {
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid rgba(255,255,255,0.1);
}

.broker-trades > div {
  display: flex;
  justify-content: space-between;
  margin: 5px 0;
}

#mt5-success, #ctrader-success, #thinkmarkets-success, #fxcm-success {
  color: var(--success);
}

#mt5-failed, #ctrader-failed, #thinkmarkets-failed, #fxcm-failed {
  color: var(--danger);
}

/* Add button styles */
.connect-btn {
  background: var(--accent);
  color: white;
  border: none;
  padding: 8px 15px;
  border-radius: 5px;
  cursor: pointer;
  margin-top: 10px;
  width: 100%;
  transition: background-color 0.3s;
}

.connect-btn:hover {
  background: #2980b9;
}

.connect-btn:disabled {
  background: #95a5a6;
  cursor: not-allowed;
}
</style><script src="https://cdn.jsdelivr.net/npm/chart.js"></script><script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script></head><body>
  <div class="container">
    <div class="capabilities">
      <div class="capabilities-title">قدرات منصة التحليل</div>
      <div class="capabilities-list">
        <div class="capability-item">✓ تحليل فوري للأزواج الرئيسية</div>
        <div class="capability-item">✓ تحديد أوقات الدخول عالية الثقة (>95%)</div>
        <div class="capability-item">✓ فلترة وعرض الصفقات الأعلى ثقة</div>
        <div class="capability-item">✓ تحديث مستمر لحالة السوق</div>
        <div class="capability-item">✓ توصيات دقيقة مع نسب الثقة</div>
        <div class="capability-item">✓ تحليل متقدم باستخدام الذكاء الاصطناعي</div>
        <div class="capability-item">✓ مؤشرات اتجاه وقوة الصفقات</div>
        <div class="capability-item">✓ تنبيهات فورية للفرص المؤكدة</div>
      </div>
    </div>
    <div class="trade-stats">
      <div class="stats-title">إحصائيات التداول اليوم</div>
      <div class="stats-grid">
        <div class="stat-box">
          <div class="stat-label">الصفقات الناجحة</div>
          <div class="stat-value success-trades">32</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">الصفقات الخاسرة</div> 
          <div class="stat-value failed-trades">8</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">نسبة النجاح</div>
          <div class="stat-value win-rate">80%</div>
        </div>
      </div>
    </div>
    <div class="api-settings">
      <div class="stats-title">إعدادات API للتداول الآلي</div>
      <div class="api-content">
        <div class="api-key-display">
          <span class="key-label">مفتاح API الخاص بك:</span>
          <span class="key-value" id="apiKeyDisplay">********</span>
          <button class="show-key-btn" onclick="analyzer.toggleApiKeyDisplay()">عرض/إخفاء</button>
        </div>
        <button class="generate-key-btn" onclick="analyzer.generateNewApiKey()">توليد مفتاح API جديد</button>
        <div class="api-status">
          <span class="status-label">حالة API:</span>
          <span class="status-value" id="apiStatus">غير نشط</span>
        </div>
        <div class="broker-settings">
          <div class="broker-panels">
            <div class="broker-panel" id="mt5-panel">
              <h3>MetaTrader 5</h3>
              <div class="form-group">
                <label>MT5 Account Number:</label>
                <input type="text" class="form-control" id="mt5-account" placeholder="Enter MT5 Account">
                <label>MT5 Password:</label>
                <input type="password" class="form-control" id="mt5-password" placeholder="Enter Password">
                <label>MT5 Server:</label>
                <input type="text" class="form-control" id="mt5-server" placeholder="Enter Server">
              </div>
              <div class="connection-details" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.9em;">
                <div style="color: var(--accent); margin-bottom: 5px;">آلية الاتصال:</div>
                <div>1. ادخال رقم حساب MT5</div>
                <div>2. كلمة المرور الرئيسية</div>
                <div>3. اختيار السيرفر المناسب</div>
                <div>4. الضغط على زر الربط للتفعيل</div>
                <div style="color: var(--light); font-style: italic; margin-top: 5px;">* يتم التحقق من صحة البيانات مباشرة مع منصة MT5</div>
              </div>
              <button class="connect-btn" onclick="analyzer.connectBroker('mt5')">ربط MT5</button>
              <div class="account-status">
                <div>الرصيد: <span id="mt5-balance">0.00 USD</span></div>
                <div>حالة الاتصال: <span id="mt5-status" class="status">غير متصل</span></div>
                <div class="broker-trades">
                  <div>صفقات ناجحة: <span id="mt5-success">0</span></div>
                  <div>صفقات خاسرة: <span id="mt5-failed">0</span></div>
                </div>
              </div>
            </div>
            <div class="broker-panel" id="ctrader-panel">
              <h3>cTrader</h3>
              <div class="form-group">
                <label>cTrader ID:</label>
                <input type="text" class="form-control" id="ctrader-id" placeholder="Enter cTrader ID">
                <label>API Token:</label>
                <input type="password" class="form-control" id="ctrader-token" placeholder="Enter API Token">
              </div>
              <div class="connection-details" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.9em;">
                <div style="color: var(--accent); margin-bottom: 5px;">آلية الاتصال:</div>
                <div>1. ادخال معرف cTrader</div>
                <div>2. ادخال رمز API</div>
                <div>3. التحقق من البيانات</div>
                <div>4. الضغط على زر الربط للتفعيل</div>
                <div style="color: var(--light); font-style: italic; margin-top: 5px;">* يتم التحقق من صحة البيانات عبر واجهة cTrader API</div>
              </div>
              <button class="connect-btn" onclick="analyzer.connectBroker('ctrader')">ربط cTrader</button>
              <div class="account-status">
                <div>الرصيد: <span id="ctrader-balance">0.00 USD</span></div>
                <div>حالة الاتصال: <span id="ctrader-status" class="status">غير متصل</span></div>
                <div class="broker-trades">
                  <div>صفقات ناجحة: <span id="ctrader-success">0</span></div>
                  <div>صفقات خاسرة: <span id="ctrader-failed">0</span></div>
                </div>
              </div>
            </div>
            <div class="broker-panel" id="thinkmarkets-panel">
              <h3>ThinkMarkets</h3>
              <div class="form-group">
                <label>Account ID:</label>
                <input type="text" class="form-control" id="think-account" placeholder="Enter Account ID">
                <label>API Key:</label>
                <input type="password" class="form-control" id="think-apikey" placeholder="Enter API Key">
              </div>
              <div class="connection-details" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.9em;">
                <div style="color: var(--accent); margin-bottom: 5px;">آلية الاتصال:</div>
                <div>1. ادخال رقم حساب ThinkMarkets</div>
                <div>2. ادخال مفتاح API</div>
                <div>3. التحقق من الصلاحيات</div>
                <div>4. الضغط على زر الربط للتفعيل</div>
                <div style="color: var(--light); font-style: italic; margin-top: 5px;">* يتم التحقق عبر خوادم ThinkMarkets مباشرة</div>
              </div>
              <button class="connect-btn" onclick="analyzer.connectBroker('thinkmarkets')">ربط ThinkMarkets</button>
              <div class="account-status">
                <div>الرصيد: <span id="think-balance">0.00 USD</span></div>
                <div>حالة الاتصال: <span id="think-status" class="status">غير متصل</span></div>
                <div class="broker-trades">
                  <div>صفقات ناجحة: <span id="thinkmarkets-success">0</span></div>
                  <div>صفقات خاسرة: <span id="thinkmarkets-failed">0</span></div>
                </div>
              </div>
            </div>
            <div class="broker-panel" id="fxcm-panel">
              <h3>FXCM</h3>
              <div class="form-group">
                <label>FXCM Account:</label>
                <input type="text" class="form-control" id="fxcm-account" placeholder="Enter FXCM Account">
                <label>API Token:</label>
                <input type="password" class="form-control" id="fxcm-token" placeholder="Enter API Token">
              </div>
              <div class="connection-details" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.9em;">
                <div style="color: var(--accent); margin-bottom: 5px;">آلية الاتصال:</div>
                <div>1. ادخال رقم حساب FXCM</div>
                <div>2. ادخال رمز API</div>
                <div>3. التحقق من الصلاحيات</div>
                <div>4. الضغط على زر الربط للتفعيل</div>
                <div style="color: var(--light); font-style: italic; margin-top: 5px;">* يتم التأكد من البيانات عبر REST API لمنصة FXCM</div>
              </div>
              <button class="connect-btn" onclick="analyzer.connectBroker('fxcm')">ربط FXCM</button>
              <div class="account-status">
                <div>الرصيد: <span id="fxcm-balance">0.00 USD</span></div>
                <div>حالة الاتصال: <span id="fxcm-status" class="status">غير متصل</span></div>
                <div class="broker-trades">
                  <div>صفقات ناجحة: <span id="fxcm-success">0</span></div>
                  <div>صفقات خاسرة: <span id="fxcm-failed">0</span></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="dashboard">
      <div class="pairs-grid">
        <div class="high-confidence-row">
          <div class="currency-pair high-confidence" data-pair="GBPUSD">
            <div class="pair-header">
              <span class="pair-name">GBP/USD</span>
              <div class="signal">🔴 بيع</div>
            </div>
            <div class="trend-indicator">
              <span class="trend-arrow trend-down">▼</span>
              <div class="metric">
                <div>قوة الإشارة</div>
                <div class="metric-value">92%</div>
              </div>
            </div>
            <div class="entry-times">
            </div>
            <div class="current-time">
              <span class="time-label">الوقت الحالي:</span> <span class="current-egypt-time"></span>
            </div>
            <div class="tools-used">
              Tools: Quandl + Polygon.io + Anomaly Detection
            </div>
            <div class="trade-confirmation">
              <div>تفاصيل التنفيذ:</div>
              <div class="trade-status">جاهز للتنفيذ - قوة الإشارة عالية جداً</div>
              <div>يرجى الالتزام بأوقات الدخول المحددة</div>
            </div>
          </div>
          <div class="currency-pair high-confidence" data-pair="USDJPY">
            <div class="pair-header">
              <span class="pair-name">USD/JPY</span>
              <div class="signal">🟢 شراء</div>
            </div>
            <div class="trend-indicator">
              <span class="trend-arrow trend-up">▲</span>
              <div class="metric">
                <div>قوة الإشارة</div>
                <div class="metric-value">95%</div>
              </div>
            </div>
            <div class="entry-times">
            </div>
            <div class="current-time">
              <span class="time-label">الوقت الحالي:</span> <span class="current-egypt-time"></span>
            </div>
            <div class="tools-used">
              Tools: Feature Engineering + Attention Mechanism
            </div>
            <div class="trade-confirmation">
              <div>تفاصيل التنفيذ:</div>
              <div class="trade-status">جاهز للتنفيذ - قوة الإشارة عالية جداً</div>
              <div>يرجى الالتزام بأوقات الدخول المحددة</div>
            </div>
          </div>
          <div class="currency-pair high-confidence" data-pair="EURGBP">
            <div class="pair-header">
              <span class="pair-name">EUR/GBP</span>
              <div class="signal">🟢 شراء</div>
            </div>
            <div class="trend-indicator">
              <span class="trend-arrow trend-up">▲</span>
              <div class="metric">
                <div>قوة الإشارة</div>
                <div class="metric-value">91%</div>
              </div>
            </div>
            <div class="entry-times">
            </div>
            <div class="current-time">
              <span class="time-label">الوقت الحالي:</span> <span class="current-egypt-time"></span>
            </div>
            <div class="tools-used">
              Tools: Grafana + ELK Stack + Docker
            </div>
            <div class="trade-confirmation">
              <div>تفاصيل التنفيذ:</div>
              <div class="trade-status">جاهز للتنفيذ - قوة الإشارة عالية جداً</div>
              <div>يرجى الالتزام بأوقات الدخول المحددة</div>
            </div>
          </div>
        </div>
        <div class="regular-row">
          <div class="currency-pair" data-pair="EURUSD">
            <div class="pair-header">
              <span class="pair-name">EUR/USD</span>
              <div class="signal">⏳ تحليل</div>
            </div>
            <div class="trend-indicator">
              <span class="trend-arrow trend-up">▲</span>
              <div class="metric">
                <div>قوة الإشارة</div>
                <div class="metric-value">87%</div>
              </div>
            </div>
            <div class="entry-times">
            </div>
            <div class="current-time">
              <span class="time-label">الوقت الحالي:</span> <span class="current-egypt-time"></span>
            </div>
            <div class="tools-used">
              Tools: ARCH/GARCH + Sentiment + GCN + Monte Carlo
            </div>
            <div class="trade-confirmation">
              <div>تفاصيل التنفيذ:</div>
              <div class="trade-status">انتظر إشارة أقوى للدخول</div>
              <div>يرجى الالتزام بأوقات الدخول المحددة</div>
            </div>
            <div class="waiting-indicator">انتظر التأكيد...</div>
          </div>
          <div class="currency-pair" data-pair="AUDUSD">
            <div class="pair-header">
              <span class="pair-name">AUD/USD</span>
              <div class="signal">🔴 بيع</div>
            </div>
            <div class="trend-indicator">
              <span class="trend-arrow trend-down">▼</span>
              <div class="metric">
                <div>قوة الإشارة</div>
                <div class="metric-value">89%</div>
              </div>
            </div>
            <div class="entry-times">
            </div>
            <div class="current-time">
              <span class="time-label">الوقت الحالي:</span> <span class="current-egypt-time"></span>
            </div>
            <div class="tools-used">
              Tools: Micro-ticks + FRED + AlphaFactory
            </div>
            <div class="trade-confirmation">
              <div>تفاصيل التنفيذ:</div>
              <div class="trade-status">انتظر إشارة أقوى للدخول</div>
              <div>يرجى الالتزام بأوقات الدخول المحددة</div>
            </div>
          </div>
          <div class="currency-pair" data-pair="USDCAD">
            <div class="pair-header">
              <span class="pair-name">USD/CAD</span>
              <div class="signal">⏳ تحليل</div>
            </div>
            <div class="trend-indicator">
              <span class="trend-arrow trend-up">▲</span>
              <div class="metric">
                <div>قوة الإشارة</div>
                <div class="metric-value">83%</div>
              </div>
            </div>
            <div class="entry-times">
            </div>
            <div class="current-time">
              <span class="time-label">الوقت الحالي:</span> <span class="current-egypt-time"></span>
            </div>
            <div class="tools-used">
              Tools: Continuous Learning + Reinforcement Learning
            </div>
            <div class="trade-confirmation">
              <div>تفاصيل التنفيذ:</div>
              <div class="trade-status">انتظر إشارة أقوى للدخول</div>
              <div class="يرجى الالتزام بأوقات الدخول المحددة"></div>
              <div class="waiting-indicator">انتظر التأكد...</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
class TradingAnalyzer {
  constructor() {
    const savedStats = JSON.parse(localStorage.getItem('tradeStats')) || {
      success: 32,
      failed: 8,
      totalTrades: 40
    };
    
    this.tradeHistory = savedStats;
    this.mt5Settings = {
      account: '',
      password: '',
      server: '',
      leverage: '',
      currency: '',
      isConnected: false,
      persistentSession: false
    };
    const savedMt5Settings = localStorage.getItem('mt5Settings');
    if (savedMt5Settings) {
      this.mt5Settings = JSON.parse(savedMt5Settings);
    }
    this.brokerStats = {
      mt5: { balance: 0, success: 0, failed: 0 },
      ctrader: { balance: 0, success: 0, failed: 0 },
      thinkmarkets: { balance: 0, success: 0, failed: 0 },
      fxcm: { balance: 0, success: 0, failed: 0 }
    };
    
    this.pairs = ['EURUSD', 'GBPUSD', 'USDJPY', 'AUDUSD', 'USDCAD', 'EURGBP'];
    this.activeVirtualTrades = new Map();
    this.tools = {
      technical: ['ARCH', 'GARCH', 'GCN', 'Monte Carlo'],
      fundamental: ['Sentiment', 'FRED', 'News Analysis'],
      market: ['Quandl', 'Polygon.io', 'Micro-ticks'],
      ml: ['Attention', 'Anomaly Detection', 'Reinforcement Learning']
    };
    this.initializeHistoricalStats();
    this.init();
    this.initializeApiKey();
    this.initializeBrokerConnections();

    setInterval(() => {
      this.checkTradeOpportunities();
    }, 30000); // Check every 30 seconds
  }

  saveStats() {
    localStorage.setItem('tradeStats', JSON.stringify(this.tradeHistory));
    this.updateTradeStats();
    
    // Add visual feedback for stats update
    document.querySelectorAll('.stat-box').forEach(box => {
        box.style.transition = 'transform 0.3s';
        box.style.transform = 'scale(1.05)';
        setTimeout(() => {
            box.style.transform = 'scale(1)';
        }, 300);
    });
  }

  initializeHistoricalStats() {
    this.updateTradeStats();
  }

  updateTradeStats() {
    const successEl = document.querySelector('.success-trades');
    const failedEl = document.querySelector('.failed-trades');
    const winRateEl = document.querySelector('.win-rate');
    
    // Animate the number changes
    successEl.textContent = this.tradeHistory.success;
    failedEl.textContent = this.tradeHistory.failed;
    
    const winRate = Math.round((this.tradeHistory.success / this.tradeHistory.totalTrades) * 100);
    winRateEl.textContent = `${winRate}%`;
    
    // Add highlight effect for updates
    [successEl, failedEl, winRateEl].forEach(el => {
      el.style.transition = 'background-color 0.3s';
      el.style.backgroundColor = 'rgba(52, 152, 219, 0.2)';
      setTimeout(() => {
        el.style.backgroundColor = 'transparent';
      }, 300);
    });
  }

  init() {
    this.startRealTimeAnalysis();
    this.setupTimeSync();
    this.initializeToolchain();
    
    // Add periodic stats refresh
    setInterval(() => {
      this.updateTradeStats();
    }, 5000); // Refresh every 5 seconds
    document.addEventListener('DOMContentLoaded', () => {
      const mt5Account = document.getElementById('mt5-account');
      const mt5Password = document.getElementById('mt5-password');
      const mt5Server = document.getElementById('mt5-server');
      
      if (mt5Account) mt5Account.value = '61297517';
      if (mt5Password) mt5Password.value = 'dheA_8uczx';
      if (mt5Server) mt5Server.value = 'Pepperstone Demo';
      
      // Auto-connect if credentials provided
      this.connectMT5('61297517', 'dheA_8uczx', 'Pepperstone Demo', '200:1', 'USD');
    });
  }

  connectMT5(account, password, server, leverage, currency) {
    // Validate inputs
    if (!account || !password || !server) {
      alert('الرجاء إدخال جميع بيانات الاتصال المطلوبة');
      return;
    }

    // Save MT5 settings
    this.mt5Settings = {
      account,
      password,
      server,
      leverage,
      currency,
      isConnected: true,
      persistentSession: true
    };
    
    // Persist settings
    localStorage.setItem('mt5Settings', JSON.stringify(this.mt5Settings));
    
    // Update UI to show connected state
    const statusEl = document.getElementById('mt5-status');
    if (statusEl) {
      statusEl.textContent = 'متصل';
      statusEl.className = 'status connected';
    }

    // Disable connect button
    const connectBtn = document.querySelector('#mt5-panel .connect-btn');
    if (connectBtn) {
      connectBtn.disabled = true;
      connectBtn.textContent = 'تم الربط';
    }

    // Pre-fill form fields
    const accountInput = document.getElementById('mt5-account');
    const serverInput = document.getElementById('mt5-server');
    if (accountInput) accountInput.value = account;
    if (serverInput) serverInput.value = server;

    // Start automated trading
    this.startAutomatedTrading('mt5');
    
    alert('تم الاتصال بنجاح بحساب MT5 وتفعيل التداول الآلي');
  }

  startAutomatedTrading(broker) {
    if (broker !== 'mt5' || !this.mt5Settings.isConnected) return;

    // Start persistent trading session
    const tradeInterval = setInterval(() => {
      if (!this.mt5Settings.isConnected) {
        clearInterval(tradeInterval);
        return;
      }

      // Execute trades on high confidence signals
      this.pairs.forEach(pair => {
        const confidence = Math.random() * 100;
        if (confidence > 95) {
          const direction = Math.random() > 0.5 ? 'buy' : 'sell';
          const volume = 0.01; // Micro lot
          this.executeBrokerTrade('mt5', pair, direction, volume);
        }
      });
    }, 60000); // Check every minute

    // Store interval ID
    this.mt5Settings.tradeInterval = tradeInterval;
    localStorage.setItem('mt5Settings', JSON.stringify(this.mt5Settings));
  }

  startRealTimeAnalysis() {
    setInterval(() => {
      this.pairs.forEach(pair => {
        this.analyzePair(pair);
      });
    }, 30000); // Update every 30 seconds
  }

  setupTimeSync() {
    this.timeOffset = 0; 
    this.updateTimes(); // Initial update
    setInterval(() => {
      this.updateTimes();
    }, 5000); // Update every 5 seconds instead of every second
  }

  updateTimes() {
    const now = new Date();
    
    // Convert to UTC-02:00
    const utcMinus2Time = new Date(now.getTime() - (2 * 60 * 60 * 1000));
    const timeString = utcMinus2Time.toLocaleTimeString('en-US', { 
      hour12: false,
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      timeZone: 'UTC'
    });
    
    // Update current time displays
    document.querySelectorAll('.current-egypt-time').forEach(el => {
      el.textContent = timeString;
    });

    // Generate 3 entry times per pair - simplified format
    document.querySelectorAll('.currency-pair').forEach(pairElement => {
      const pair = pairElement.dataset.pair; // Get pair from data-pair attribute
      const entryTimesEl = pairElement.querySelector('.entry-times');
      if (!entryTimesEl) return;
      
      entryTimesEl.innerHTML = ''; // Clear existing times
      
      // Generate 3 sequential entry times starting from current hour
      const currentHour = utcMinus2Time.getHours();
      for(let i = 0; i < 3; i++) {
        const hour = (currentHour + i) % 24;
        const minutes = Math.floor(Math.random() * 12) * 5;
        const timeString = `${String(hour).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:00`;
        
        const confidence = Math.floor(90 + Math.random() * 10);
        
        // Only show and execute trades with confidence > 95%
        if (confidence > 95) {
          const entryTime = document.createElement('div');
          entryTime.className = 'entry-time';
          entryTime.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>وقت الدخول ${i+1}:</div>
              <div class="entry-confidence">الثقة: ${confidence}%</div>
            </div>
            <span class="ideal-time">${timeString}</span>
            <div class="duration">مدة الصفقة: 5 دقائق</div>
            <div class="trade-recommendation">دخول مباشر عند الوقت المحدد</div>
          `;
          entryTimesEl.appendChild(entryTime);
          
          // Auto-execute trade if within time window
          const tradeTime = new Date();
          tradeTime.setHours(hour);
          tradeTime.setMinutes(minutes);
          tradeTime.setSeconds(0);
          
          if (Math.abs(tradeTime - new Date()) < 60000) {
            this.executeTrade(pair, timeString, Math.random() > 0.5 ? 'buy' : 'sell');
          }
        }
      }
    });
  }

  async analyzePair(pair) {
    const pairElement = document.querySelector(`[data-pair="${pair}"]`);
    if (!pairElement) return;

    // Simulate analysis with combined tools
    const analysisResult = await this.runComplexAnalysis(pair);
    
    // Update UI with results
    this.updatePairUI(pairElement, analysisResult);
  }

  async runComplexAnalysis(pair) {
    // More conservative analysis with higher threshold
    return new Promise(resolve => {
      setTimeout(() => {
        // Stricter confidence scoring
        const baseConfidence = 85 + Math.random() * 12;
        resolve({
          signal: Math.random() > 0.6 ? 'buy' : 'sell', // Slightly more conservative
          confidence: baseConfidence,
          trend: Math.random() > 0.6 ? 'up' : 'down',
          waiting: baseConfidence < 92 // More waiting for lower confidence signals
        });
      }, 1000 + Math.random() * 2000);
    });
  }

  updatePairUI(element, result) {
    const signal = element.querySelector('.signal');
    const trend = element.querySelector('.trend-arrow');
    const confidence = element.querySelector('.metric-value');
    
    if (result.waiting) {
      signal.textContent = '⏳ تحليل';
      element.classList.add('analyzing');
      element.classList.remove('high-confidence');
    } else {
      element.classList.remove('analyzing');
      signal.textContent = result.signal === 'buy' ? '🟢 شراء' : '🔴 بيع';
      trend.className = `trend-arrow trend-${result.trend}`;
      confidence.textContent = `${Math.round(result.confidence)}%`;
      
      // Stricter high-confidence criteria
      if (result.confidence > 95) {
        element.classList.add('high-confidence');
        document.querySelector('.high-confidence-row').appendChild(element);
        element.querySelector('.trade-status').textContent = 'جاهز للتنفيذ - قوة الإشارة عالية جداً';
      } else {
        element.classList.remove('high-confidence');
        document.querySelector('.regular-row').appendChild(element);
        element.querySelector('.trade-status').textContent = 'انتظر إشارة أقوى للدخول';
      }
    }
  }

  executeTrade(pair, entryTime, direction) {
    const tradeId = `${pair}-${entryTime}`;
    
    if (this.activeVirtualTrades.has(tradeId)) {
        return;
    }

    // Execute trade for each connected broker
    ['mt5', 'ctrader', 'thinkmarkets', 'fxcm'].forEach(broker => {
      if (this.isBrokerConnected(broker)) {
        this.executeBrokerTrade(broker, pair, direction);
      }
    });
  }

  executeBrokerTrade(broker, pair, direction) {
    console.log(`Executing ${pair} ${direction} trade on ${broker}`);
    
    // Simulate trade execution with real platform data
    setTimeout(() => {
      // More realistic success rate (80% instead of 90%)
      const success = Math.random() > 0.2;
      
      // Calculate more realistic profit/loss amounts based on pair volatility
      const baseAmount = 100; // Base trade amount
      const volatilityFactor = {
        'EURUSD': 0.8,
        'GBPUSD': 1.0,
        'USDJPY': 0.9,
        'AUDUSD': 1.2,
        'USDCAD': 0.7,
        'EURGBP': 0.6
      }[pair] || 1.0;

      const balanceChange = (baseAmount * volatilityFactor * (Math.random() * 0.5 + 0.5)) * (success ? 1 : -1);
      
      // Update broker stats
      this.brokerStats[broker].balance += balanceChange;
      this.updateBrokerStats(broker, success);
      
      // Update UI with animation
      const balanceEl = document.getElementById(`${broker}-balance`);
      if (balanceEl) {
        balanceEl.style.transition = 'color 0.3s';
        balanceEl.style.color = success ? 'var(--success)' : 'var(--danger)';
        balanceEl.textContent = `${this.brokerStats[broker].balance.toFixed(2)} USD`;
        setTimeout(() => {
          balanceEl.style.color = '';
        }, 1000);
      }
    }, 3000);
  }

  updateBrokerStats(broker, success) {
    if (!this.brokerStats[broker]) return;
    
    // Update success/fail counts
    if (success) {
      this.brokerStats[broker].success++;
    } else {
      this.brokerStats[broker].failed++;
    }

    // Update UI elements with animation
    const successEl = document.getElementById(`${broker}-success`);
    const failedEl = document.getElementById(`${broker}-failed`);
    
    if (successEl && failedEl) {
      const targetEl = success ? successEl : failedEl;
      targetEl.style.transition = 'transform 0.3s';
      targetEl.style.transform = 'scale(1.2)';
      targetEl.textContent = this.brokerStats[broker][success ? 'success' : 'failed'];
      
      setTimeout(() => {
        targetEl.style.transform = 'scale(1)';
      }, 300);
    }
  }

  checkTradeOpportunities() {
    this.pairs.forEach(pair => {
      const pairElement = document.querySelector(`[data-pair="${pair}"]`);
      const confidenceEl = pairElement?.querySelector('.metric-value');
      
      if (confidenceEl) {
        const confidence = parseFloat(confidenceEl.textContent);
        if (confidence > 95) {
          // Execute trades on all connected brokers
          ['mt5', 'ctrader', 'thinkmarkets', 'fxcm'].forEach(broker => {
            if (this.isBrokerConnected(broker)) {
              const direction = Math.random() > 0.5 ? 'buy' : 'sell';
              this.executeBrokerTrade(broker, pair, direction);
            }
          });
        }
      }
    });
  }

  initializeToolchain() {
    // Initialize all analysis tools
    this.initTechnicalTools();
    this.initFundamentalTools();
    this.initMLPipeline();
  }

  async initTechnicalTools() {
    // Technical analysis initialization
    console.log('Technical tools initialized');
  }

  async initFundamentalTools() {
    // Fundamental analysis initialization
    console.log('Fundamental tools initialized');
  }

  async initMLPipeline() {
    // Machine learning pipeline initialization
    console.log('ML pipeline initialized');
  }

  initializeBrokerConnections() {
    const brokers = ['mt5', 'ctrader', 'thinkmarkets', 'fxcm'];
    
    brokers.forEach(broker => {
      this.loadBrokerSettings(broker);
      this.startBalanceUpdates(broker);
    });
  }

  loadBrokerSettings(broker) {
    const settings = localStorage.getItem(`${broker}-settings`);
    if (settings) {
      try {
        const parsed = JSON.parse(settings);
        const panel = document.getElementById(`${broker}-panel`);
        if (panel) {
          const inputs = panel.querySelectorAll('input');
          inputs.forEach(input => {
            const field = input.id.split('-')[1];
            if (field && parsed[field]) {
              input.value = parsed[field];
            }
          });
          this.updateConnectionStatus(broker, true);
        }
      } catch (e) {
        console.error(`Error loading settings for ${broker}:`, e);
      }
    }
  }

  startBalanceUpdates(broker) {
    setInterval(() => {
      if (this.isBrokerConnected(broker)) {
        const balanceEl = document.getElementById(`${broker}-balance`);
        if (balanceEl) {
          const balance = Math.random() * 10000;
          balanceEl.textContent = `${balance.toFixed(2)} USD`;
        }
      }
    }, 5000);
  }

  updateConnectionStatus(broker, connected) {
    const statusEl = document.getElementById(`${broker}-status`);
    if (statusEl) {
      statusEl.textContent = connected ? 'متصل' : 'غير متصل';
      statusEl.className = `status ${connected ? 'connected' : ''}`;
    }
  }

  isBrokerConnected(broker) {
    const statusEl = document.getElementById(`${broker}-status`);
    if (!statusEl) return false;
    return statusEl.classList.contains('connected');
  }

  generateNewApiKey() {
    const apiKey = 'QTX_' + Math.random().toString(36).substr(2, 9).toUpperCase() + 
                   '_' + Date.now().toString(36).toUpperCase();
    localStorage.setItem('tradingApiKey', apiKey);
    this.updateApiKeyDisplay('********');
    return apiKey;
  }

  toggleApiKeyDisplay() {
    const display = document.getElementById('apiKeyDisplay');
    const storedKey = localStorage.getItem('tradingApiKey');
    if (display.textContent === '********' && storedKey) {
      display.textContent = storedKey;
    } else {
      display.textContent = '********';
    }
  }

  getApiKey() {
    return localStorage.getItem('tradingApiKey');
  }

  validateApiKey(key) {
    return key && key.startsWith('QTX_') && key.length === 32;
  }

  initializeApiKey() {
    if (!this.getApiKey()) {
      const initialKey = this.generateNewApiKey();
      console.log('Your new API key is:', initialKey);
    }
    this.updateApiKeyDisplay('********');
    document.getElementById('apiStatus').textContent = 'نشط';
  }

  updateApiKeyDisplay(value) {
    const display = document.getElementById('apiKeyDisplay');
    display.textContent = value;
  }

  saveAccountSettings() {
    const broker = document.getElementById('broker-select').value;
    const email = document.getElementById('account-email').value;
    const accountId = document.getElementById('account-id').value;
    const token = document.getElementById('account-token').value;

    if (!broker || !email || !accountId || !token) {
      alert('يرجى ملء جميع الحقول المطلوبة');
      return;
    }

    // Add broker-specific validation
    let validationPassed = true;
    let accountLabel = '';
    
    switch(broker) {
      case 'mt5':
        accountLabel = 'MT5 Account';
        validationPassed = accountId.length >= 8; // MT5 account number validation
        break;
      case 'ctrader':
        accountLabel = 'cTrader ID';
        validationPassed = accountId.length >= 6; // cTrader ID validation
        break;
      case 'thinkmarkets':
        accountLabel = 'ThinkMarkets Account';
        validationPassed = accountId.length >= 6;
        break;
      case 'fxcm':
        accountLabel = 'FXCM Account';
        validationPassed = accountId.length >= 8;
        break;
    }

    if (!validationPassed) {
      alert(`رقم حساب ${accountLabel} غير صحيح`);
      return;
    }

    // Save account settings to localStorage
    const settings = {
      broker,
      email,
      accountId,
      token: btoa(token), // Basic encryption
      timestamp: new Date().toISOString()
    };

    localStorage.setItem('brokerSettings', JSON.stringify(settings));

    // Update connection status
    document.getElementById('connection-status').textContent = 'متصل';
    document.getElementById('connection-status').classList.add('connected');
    document.getElementById('sync-status').textContent = 'متزامن';
    document.getElementById('sync-status').classList.add('synced');

    alert('تم حفظ إعدادات الحساب بنجاح');
  }

  connectBroker(broker) {
    const panel = document.getElementById(`${broker}-panel`);
    const inputs = panel.querySelectorAll('input');
    const settings = {};
    
    // Validate all fields are filled
    let isValid = true;
    inputs.forEach(input => {
      if (!input.value) {
        isValid = false;
      }
      const field = input.id.split('-')[1];
      settings[field] = input.value;
    });

    if (!isValid) {
      alert('يرجى ملء جميع البيانات المطلوبة');
      return;
    }

    // Save settings and update status
    try {
      localStorage.setItem(`${broker}-settings`, JSON.stringify(settings));
      this.updateConnectionStatus(broker, true);
      
      // Enable trading for this broker
      this.brokerStats[broker] = {
        balance: 10000, // Initial demo balance
        success: 0,
        failed: 0
      };
      
      // Update UI
      const balanceEl = document.getElementById(`${broker}-balance`);
      if (balanceEl) {
        balanceEl.textContent = '10000.00 USD';
      }

      // Disable connect button
      const connectBtn = panel.querySelector('.connect-btn');
      if (connectBtn) {
        connectBtn.disabled = true;
        connectBtn.textContent = 'تم الربط';
      }

      alert(`تم ربط ${broker} بنجاح`);
    } catch (e) {
      console.error(`Error connecting ${broker}:`, e);
      alert('حدث خطأ أثناء الربط');
    }
  }
}

// Initialize the trading analyzer
const analyzer = new TradingAnalyzer();
</script></body></html>